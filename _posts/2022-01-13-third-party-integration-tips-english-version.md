---
layout: post
title: "Surviving from integration with third-party services"
description: ""
category: 
tags: []
---
{% include JB/setup %}
## Fear of the unknown

<div style="text-align:center"><img src ="/assets/images/fear.jpeg" style="height:200px;" /></div>


Humans have an innate fear of the unknown. In a previous business opportunity, customers focused on whether we had the experience and ability to integrate with a large number of third parties. It is estimated that they also suffered a lot from third-party integration.
## Unavoidable Integration


<div style="text-align:center"><img src ="/assets/images/walk-around.jpeg" style="height:200px;" /></div>

Most modern systems are made with services from other systems because programmers can’t reinvent the wheel every time. Inevitably, almost every system will need to be integrated with another service, for example a payment gateway. Another common reason for integration is that large systems need to be developed by multiple different departments and teams, so that integration with services made by other teams is usually unavoidable.

## How to ensure smooth integration

So, how can we make the integration work less painful? Let’s look at the two types of third-party systems that might be integrated with: mature live services and services under development.

### Integrate with launched services

<div style="text-align:center"><img src ="/assets/images/on-live-system.png" style="height:150px;" /></div>

Integration with live services is relatively easier, since their functionality is complete and relatively stable. Typical examples of live third party systems are auth systems and payment systems.

#### Design Phase - Understand the responsibilities, architecture and infra of the third party

As a consumer, we need to clearly know the boundaries for the responsibility of each third-party to be integrated, to know what functionality we need to cover during the design part.

It can be identified from two perspectives: behavior and data.

- Behaviorally, what functionality does the third-party system provide? For example, the auth system provides registration, login and authority management.

- In terms of data, it’s necessary to identify key data hosted in third parties. Those data should be treated as the single source of truth in the connection among those systems. For example, when an auth system is used as a third party, the user name, password, profile information, and authority management data obtained during registration should be controlled by the auth system. When the consumer system needs to read the user profile information, it should get it from the auth system, whether it’s in real-time or through batch or cache, instead of storing another version. Otherwise, data inconsistency will cause a series of problems.

Usually, it’s almost impossible to get the whole details of a third-party service quickly, while you may only have a short time to design the integration solution. Trying to understand the architecture of the third party may be helpful. For a mature live system, there is usually architecture documentation that includes information about  the internal structure, giving us a relatively clear view of the whole system.For example, an auth system is divided into three services, with each service having its own responsibility, Issue token, service to service trust connection, authentication status management. These detailed functionalities allow us to understand the whole scope of the system.

#### Implementation Phase - Prepare the test environment for integration in advance

As the Agile Manifesto states, “Working software over comprehensive documentation.” A working testing environment provided by the third party is required to verify and debug the functionality. 

Ideally, each testing environment in our system requires a corresponding environment in the third party system including dev, qa, uat and prod, while in reality, third party systems can only provide one testing environment. Our testing environments have to be shared, which leads to data mess. For example, if the third party is a login system, the account created in the high environment will be affected by the account configuration of the lower environment, causing accidents at critical moments like PO signoff or showcase. Deeper cooperation is needed in this case.

What if the third party has no way to provide at least one test environment? A fake third party will be necessary, such as Mockpass corresponding to Singpass, or API services (moco) generated by the contract file.

What if faking the third party isn’t feasible? What we can do is clarify usage of the third-party environment and the possible consequences to the team. For example, it should be treated as normal when multiple notification emails are received when the email related functionality is triggered once.

#### The impact of third-party maintenance
Even after going live, the third party may still continually change (hopefully with version control), so possible downtime needs to be planned early and notified in time, making sure to avoid important dates like showcase or go live.
In the next part, we’ll explain how to handle third-party integration when dealing with services still under development.


### Integration with services under development


<div style="text-align:center"><img src="/assets/images/in-progress-system.jpeg" style="height:200px;" /></div>

Integrating with third-parties still under development is more challenging. You may need to help them on the design and development, continuous integration and release, or even on planning.

#### Design Phase

<div style="text-align:center"><img src="/assets/images/design.png" style="height:200px;" /></div>

##### Clarification of responsibilities scope
Setting clear responsibilities for the third party team should be the first priority to avoid problems down the line.

##### Detailed integration solutions
Authentication and Authorization solution between two systems. For end users, use SSO to navigate from one system to the other. For data exchanging, use double key verification to bridge the trust of the two servers. Authorization control in each connection point between the two systems.

Behavior and data indicator in happy path and sad path.

More importantly, the identifier of each resource during the data exchange. If the required data is ready in each connection point.

Breaking change alignment needs to be done at very early stages. Breaking change from a third party should be notified early, non breaking change should be handled painlessly in our system. More information about breaking change can be found in https://bambielli.com/til/2018-01-12-what-is-a-breaking-change/.

The design phase might be long and painful, but it is necessary to keep doing and align with the third party team, since architecture keeps evolving and the aligned design version keeps changing. We might go far in the wrong direction if the design isn’t in continuous alignment.

#### Implementation Phase

<div style="text-align:center"><img src="/assets/images/implementation.jpeg" style="height:200px;" /></div>
You might still encounter problems during the implementation phase even if the design phase went perfectly. Expected functionality might not be ready as agreed, bugs might keep popping up in developed functionalities, etc. Here are some tips I learned from previous projects.

##### Timeline

At this point, you need to establish a timeline, setting up milestones for important functions. Even though we are Agile, embracing change doesn’t mean failing to plan.

##### Real-time communication

Having a real-time communication channel with the third party team is essential to solving problems like data preparation throughout different phases, incomplete functions handling, changing requirements, etc. Cooperation is also paramount. Remaining flexible on minor issues will help make the integration work easier and more sustainable.

##### Advance planing
For example, for advance planning of go live, we need to notify the third party teams not to change things like code version, app configuration and to keep their servers stable. On our side, advance regression verifying the functionality related to the third party system is also necessary, to avoid “surprises.”

##### Prepare for the unexpected

Planning for the unexpected should involve both our team and the third party team. But even when you think everything is ready, you might still encounter surprises because human error can never be totally avoided. Once, we found that third-party related functionalities that had been confirmed as working the previous day didn’t work on launch day. Fortunately, thanks to the log we’d implemented in the system, we were able to find and solve the problem quickly.

## Conclusion
With the explosion of services, smooth integration with other systems is a critical aspect for success in software services and shouldn’t be avoided out of fear of complications.
